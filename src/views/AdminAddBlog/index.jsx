import { Button, message, Steps, theme } from 'antd';
import { useState, useRef } from 'react';
import AddBlog from '../../component/AdminAddBlog/AddBlog';
import AddContent from '../../component/AdminAddBlog/AddContent';
import moment from 'moment/moment';
import { nanoid } from 'nanoid';
import {setBlog} from '../../api/login';
import { useNavigate } from 'react-router-dom';

const AdminAddBlog = () => {
    let navigate = useNavigate()
    let [blogInfo,setBlogInfo] = useState(null)
    //商品富文本标签
    let contentRef = useRef();
    //传给子组件下一步回调
    const nextBtn = () => {
        next()
    }
    //收集博客数据
    const getBlogInfo = (value)=>{
        setBlogInfo(value)
    }
    //保存博客
    const addBlogInfo = async ()=>{
        if(!contentRef.current.myEditor.txt.html()){
            message.error('请输入正文')
            return
        }
        //博客信息
        let obj = blogInfo;
        obj.content = contentRef.current.myEditor.txt.html()
        //获取当前时间
        let time = Date.now()
        time = moment(time).format('YYYY-MM-DD HH:mm:ss')
        obj.time = time
        obj.id = nanoid()
        obj.star = 0
        //发送请求保存到数据库
        let res = await setBlog(obj)
        next()
    }
    const steps = [
        {
            title: '填写博客信息',
            content: <AddBlog nextBtn={nextBtn} getBlogInfo={getBlogInfo}></AddBlog>,
        },
        {
            title: '撰写博客',
            content: <div>
                <AddContent ref={contentRef} ></AddContent>
                <div>
                    <Button onClick={()=>prev} style={{ marginRight: '10px' }}>上一步</Button>
                    <Button type='primary' onClick={()=>addBlogInfo()}>完成</Button>
                </div>
            </div>,
        },
        {
            title: '发表博客',
            content: '',
        },
    ];
    const { token } = theme.useToken();
    const [current, setCurrent] = useState(0);
    const next = () => {
        setCurrent(current + 1);
    };
    const prev = () => {
        setCurrent(current - 1);
    };
    const items = steps.map((item) => ({
        key: item.title,
        title: item.title,
    }));
    const contentStyle = {
        lineHeight: '260px',
        textAlign: 'center',
        color: token.colorTextTertiary,
        backgroundColor: token.colorFillAlter,
        borderRadius: token.borderRadiusLG,
        border: `1px dashed ${token.colorBorder}`,
        marginTop: 16,
        paddingTop: 30,
    };

    return (
        <>
            <Steps current={current} items={items} />
            <div style={contentStyle}>{steps[current].content}</div>
            <div
                style={{
                    marginTop: 24,
                }}
            >
                {current === steps.length - 1 && (
                    <Button type="primary" onClick={() => {
                        message.success('发表成功!')
                        navigate('/admin/adminbloglist')
                    }}>
                        完成
                    </Button>
                )}
            </div>
        </>
    );
};
export default AdminAddBlog;